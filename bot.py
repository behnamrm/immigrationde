import os
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes, MessageHandler, filters

# โ Main menu (right-to-left)
MAIN_MENU = [
    ["โ ุณูุงูุงุช ูพุฑุชฺฉุฑุงุฑ", "๐ ฺฺฉโูุณุช ููุงุฌุฑุช"],
    ["๐ ฺฏุฑููโูุง ูพุฑุณุด ู ูพุงุณุฎ", "๐ผ ุฎุฏูุงุช ููุงุฌุฑุช"],
    ["๐ฌ ุชูุงุณ ุจุง ูุง"]
]

# โ Checklist submenu (with correct numbering and icons)
CHECKLIST_MENU = [
    ["1. โน๏ธ ฺฉุณุจ ุงุทูุงุนุงุช ฺฉู", "2. ๐ ูุฏุงุฑฺฉ ููุฑุฏ ูุงุฒ ูพุฐุฑุด"],
    ["3. ๐ฌ ูุฑุงุญู ุงุฎุฐ ูพุฐุฑุด", "4. ๐ ุขูุงุฏฺฏ ุจุฑุง ุณูุงุฑุช"],
    ["5. โ๏ธ ูุฑูุฏ ุจู ุขููุงู", "๐ ูุดุงูุฏู ููู ูุฑุงุญู"],
    ["๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู"]
]

# โ Sub items for each checklist item (with icons)
CHECKLIST_SUBITEMS = {
    "1. โน๏ธ ฺฉุณุจ ุงุทูุงุนุงุช ฺฉู": [
        "๐ฉ๐ช ฺุฑุง ฺฉุดูุฑ ุขููุงูุ", "๐ ุงููุงุน ููุงุทุน ุชุญุตู ุฏุฑ ุขููุงู", "๐ฃ๏ธ ุชุญุตู ุจู ุขููุงู ุง ุงูฺฏูุณุ",
        "๐ ูพุฐุฑุด ูุดุฑูุท ุง ูุณุชููุ", "๐ ุงููุงุน ุขุฒููู ูุง ุฒุจุงู ุขููุงู", "๐ฌ ฺุทูุฑ ูพุฐุฑุด ุจฺฏุฑูุ",
        "๐ ุจูุฑุณู ุชุญุตู", "๐ฐ ูุฒูู ูุง ุฒูุฏฺฏ ุฏุฑ ุขููุงู", "๐จโ๐ผ ฺฉุงุฑ ุฏุงูุดุฌู ุฏุฑ ุขููุงู",
        "๐ ุชุจุฏู ูุนุฏู ุงุฑุงู ุจู ุขููุงู", "๐ผ ุจุงุฒุงุฑ ฺฉุงุฑ ู ุฏุฑุขูุฏ ุฑุดุชู ูุง ูุฎุชูู ุฏุฑ ุขููุงู",
        "๐ช ููุงูู ูุดูููุงู ุณุฑุจุงุฒ", "๐จโ๐ฉโ๐งโ๐ฆ ูุฒุง ูพูุณุช ุจู ููุณุฑ ู ุฎุงููุงุฏู"
    ],
    "2. ๐ ูุฏุงุฑฺฉ ููุฑุฏ ูุงุฒ ูพุฐุฑุด": [
        "๐ฃ๏ธ ุงุฎุฐ ูุฏุฑฺฉ ุฒุจุงู", "๐ ุชุฑุฌูู ูุฏุงุฑฺฉ", "๐ก ุณุงุฎุช ุงูฺฏุฒู ูุงูู", "๐ ุณุงุฎุช ุฑูุฒูู",
        "๐จ ุณุงุฎุช ูพูุฑุชูููู", "๐จ ุชูุตู ูุงูู ุงุฒ ุงุณุงุชุฏ", "๐งพ ฺฏูุงู ุณุงูู ฺฉุงุฑ",
        "โ ุชุงุฏ (ูฺฏุงู/ุจฺฏูุง) ูุฏุงุฑฺฉ ุชุฑุฌูู ุดุฏู ุฏุฑ ุณูุงุฑุช"
    ],
    "3. ๐ฌ ูุฑุงุญู ุงุฎุฐ ูพุฐุฑุด": [
        "๐ซ ุฏุงูุดฺฏุงู ุง ููุฎุดูููุ", "๐ ุฑูฺฉูฺฏ ุฏุงูุดฺฏุงู ูุง ุขููุงู", "๐ ุฏุฏูุงู ูพุฐุฑุด",
        "๐ ุณุงุช ูุง ุฌุณุชุฌู ุฏุงูุดฺฏุงู ู ุฑุดุชู", "๐ ูพุฐุฑุด ุงุฒ ุทุฑู ุณุงุช ูู ุงุณุณุช",
        "๐ ุณุงุช ุขูุงุจู", "๐ฅ ุงุฎุฐ ูพุฐุฑุด ุงุฒ ุฏุงูุดฺฏุงู", "๐ฆ ุงุฑุณุงู ูุฏุงุฑฺฉ ุจู ุตูุฑุช ูพุณุช",
        "๐ ุซุจุช ูุงู ููุง ุฏุฑ ุฏุงูุดฺฏุงู", "๐ก๏ธ ุจูู ุฏุงูุดุฌู", "๐ ฺฏุฑูุชู ุฎูุงุจฺฏุงู ุฏุงูุดุฌู"
    ],
    "4. ๐ ุขูุงุฏฺฏ ุจุฑุง ุณูุงุฑุช": [
        "๐ ฺฏุฑูุชู ููุจุช ุณูุงุฑุช", "๐ ฺฺฉ ูุณุช ูุฏุงุฑฺฉ ุฑูุฒ ูุตุงุญุจู", "โ ุณูุงูุงุช ูุชุฏุงูู ุฑูุฒ ูุตุงุญุจู",
        "๐ฃ๏ธ ูุตุงุญุจู ู ุชุญูู ูุฒุง", "โ ุฏูุงู ูุนููู ุฑุฌฺฉุช"
    ],
    "5. โ๏ธ ูุฑูุฏ ุจู ุขููุงู": [
        "๐ซ ุฎุฑุฏ ุจูุท ููุงูพูุง", "๐ ฺู ูุณุงู ุจุง ุฎูุฏู ุจุจุฑูุ", "๐ฌ ูุฑูุฏฺฏุงู ู ูุฑู ุฒูู",
        "๐ ูพุฏุง ฺฉุฑุฏู ุฎูุงุจฺฏุงู ู ุฎุงูู", "๐ฑ ุฎุฑุฏ ุณู ฺฉุงุฑุช ุฏุฑ ุขููุงู", "๐ข ุซุจุช ูุญู ุณฺฉููุช (ููุฏู ฺฉุฑุฏู)",
        "๐ฆ ุจุงุฒ ฺฉุฑุฏู ุญุณุงุจ ุจุงูฺฉ", "๐ชช ฺฏุฑูุชู ฺฉุงุฑุช ุงูุงูุช", "๐ ุชูุฏุฏ ุงูุงูุช ุจุนุฏ ุงุฒ ฺฉุณุงู"
    ]
}

# โ ุชูุถุญุงุช ูุฑ ุฒุฑููุถูุน ฺฺฉโูุณุช
CHECKLIST_CONTENTS = {
    "๐ฉ๐ช ฺุฑุง ฺฉุดูุฑ ุขููุงูุ": "ุขููุงู ฺฉ ุงุฒ ููุตุฏูุง ูุญุจูุจ ุจุฑุง ุชุญุตู ุจู ุฏูุงู ฺฉูุช ุจุงูุงุ ุดูุฑู ฺฉู ุง ุฑุงฺฏุงูุ ู ูุฑุตุชโูุง ฺฉุงุฑ ูพุณ ุงุฒ ูุงุฑุบโุงูุชุญุตู ุงุณุช.",
    "๐ ุงููุงุน ููุงุทุน ุชุญุตู ุฏุฑ ุขููุงู": "ุฏุฑ ุขููุงู ูโุชูุงู ุฏุฑ ููุงุทุน ฺฉุงุฑุดูุงุณุ ฺฉุงุฑุดูุงุณ ุงุฑุดุฏ ู ุฏฺฉุชุฑุง ุชุญุตู ฺฉุฑุฏ.",
    "๐ฃ๏ธ ุชุญุตู ุจู ุขููุงู ุง ุงูฺฏูุณุ": "ุจุณุชู ุจู ุฑุดุชู ู ุฏุงูุดฺฏุงูุ ุจุฑูุงููโูุง ุชุญุตู ูู ุจู ุฒุจุงู ุขููุงู ู ูู ุงูฺฏูุณ ุงุฑุงุฆู ูโุดููุฏ."
    # ๐ ูโุชูุงูุฏ ุงุฏุงูู ุฏูุฏ ุจุฑุง ุฏฺฏุฑ ููุงุฑุฏ
}

# โ /start command handler
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_name = update.effective_user.full_name

    with open("users_log.txt", "a", encoding="utf-8") as f:
        f.write(f"{user_id} - {user_name}\n")

    await update.message.reply_text(
        "ุณูุงู ๐\nุจู ุฑุจุงุช ููุงุฌุฑุช ุจู ุขููุงู ุฎูุด ุขูุฏุฏ!",
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU, resize_keyboard=True)
    )

# โ Split list into rows of n
def split_into_rows(items, row_size=2):
    return [items[i:i+row_size] for i in range(0, len(items), row_size)]

# โ Menu handler
async def handle_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    choice = update.message.text

    # Main responses first (to avoid conflict with subitem headers)
    main_responses = {
        "โ ุณูุงูุงุช ูพุฑุชฺฉุฑุงุฑ": "โน๏ธ ูพุฑุณุดโูุง ุฑุงุฌ ุฏุงูุดุฌูุงู ุงุฑุงู...",
        "๐ ฺฏุฑููโูุง ูพุฑุณุด ู ูพุงุณุฎ": "๐ฌ ููฺฉ ฺฏุฑููโูุง ููุฏ ุจุฑุง ูพุฑุณุด ู ูพุงุณุฎ: ...",
        "๐ผ ุฎุฏูุงุช ููุงุฌุฑุช": "๐งณ ุฎุฏูุงุช ูุง ุดุงูู ุงูพูุงุ ูุฒุงุ ุชุฑุฌูู ู ...",
        "๐ฌ ุชูุงุณ ุจุง ูุง": "๐จ @your_support",
        "๐ ูุดุงูุฏู ููู ูุฑุงุญู": "๐๏ธ ููู ูุฑุงุญู ููุงุฌุฑุช: ุงุฒ ุชุญูู ุชุง ูุฑูุฏ ุจู ุขููุงู..."
    }

    if choice in main_responses:
        if choice == "๐ ูุดุงูุฏู ููู ูุฑุงุญู":
            all_subitems = sum(CHECKLIST_SUBITEMS.values(), [])
            all_rows = split_into_rows(all_subitems, 3)
            all_rows.append(["๐ ุจุงุฒฺฏุดุช ุจู ฺฺฉโูุณุช"])
            await update.message.reply_text(
                "ุชูุงู ูุฑุงุญู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:",
                reply_markup=ReplyKeyboardMarkup(all_rows, resize_keyboard=True)
            )
        else:
            await update.message.reply_text(main_responses[choice])
        return

    if choice == "๐ ฺฺฉโูุณุช ููุงุฌุฑุช":
        await update.message.reply_text(
            "ูุทูุง ุฏุณุชูโุจูุฏ ููุฑุฏ ูุธุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:",
            reply_markup=ReplyKeyboardMarkup(CHECKLIST_MENU, resize_keyboard=True)
        )
        return

    if choice == "๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู":
        await update.message.reply_text(
            "ุจุงุฒฺฏุดุช ุจู ููู",
            reply_markup=ReplyKeyboardMarkup(MAIN_MENU, resize_keyboard=True)
        )
        return

    if choice == "๐ ุจุงุฒฺฏุดุช ุจู ฺฺฉโูุณุช":
        await update.message.reply_text(
            "ุจุงุฒฺฏุดุช ุจู ฺฺฉโูุณุช ููุงุฌุฑุช:",
            reply_markup=ReplyKeyboardMarkup(CHECKLIST_MENU, resize_keyboard=True)
        )
        return

    if choice in CHECKLIST_SUBITEMS:
        sub_items = CHECKLIST_SUBITEMS[choice]
        sub_menu = split_into_rows(sub_items, 2) + [["๐ ุจุงุฒฺฏุดุช ุจู ฺฺฉโูุณุช"]]
        await update.message.reply_text(
            f"ูุทูุง ฺฉ ุงุฒ ุฒุฑูุฌููุนูโูุง ยซ{choice}ยป ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:",
            reply_markup=ReplyKeyboardMarkup(sub_menu, resize_keyboard=True)
        )
        return

    if choice in CHECKLIST_CONTENTS:
        await update.message.reply_text(CHECKLIST_CONTENTS[choice])
        return

    await update.message.reply_text("ูุทูุงู ุงุฒ ฺฏุฒููโูุง ููู ุงุณุชูุงุฏู ฺฉูุฏ.")

# โ App startup
if __name__ == '__main__':
    app = ApplicationBuilder().token(os.getenv("BOT_TOKEN")).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_menu))
    app.run_polling()
