import os
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes, MessageHandler, filters

# âœ… Main menu (right-to-left)
MAIN_MENU = [
    ["â“ Ø³ÙˆØ§Ù„Ø§Øª Ù¾Ø±ØªÚ©Ø±Ø§Ø±", "ğŸ“ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù…Ù‡Ø§Ø¬Ø±Øª"],
    ["ğŸ”— Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø®", "ğŸ’¼ Ø®Ø¯Ù…Ø§Øª Ù…Ù‡Ø§Ø¬Ø±ØªÛŒ"],
    ["ğŸ“¬ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§"]
]

# âœ… Checklist submenu (with correct numbering and icons)
CHECKLIST_MENU = [
    ["1. â„¹ï¸ Ú©Ø³Ø¨ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ", "2. ğŸ“„ Ù…Ø¯Ø§Ø±Ú© Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ù¾Ø°ÛŒØ±Ø´"],
    ["3. ğŸ“¬ Ù…Ø±Ø§Ø­Ù„ Ø§Ø®Ø° Ù¾Ø°ÛŒØ±Ø´", "4. ğŸ›‚ Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Øª"],
    ["5. âœˆï¸ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†", "ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„"],
    ["ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ"]
]

# âœ… Sub items for each checklist item (with icons)
CHECKLIST_SUBITEMS = {
    "1. â„¹ï¸ Ú©Ø³Ø¨ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ": [
        "ğŸ‡©ğŸ‡ª Ú†Ø±Ø§ Ú©Ø´ÙˆØ± Ø¢Ù„Ù…Ø§Ù†ØŸ", "ğŸ“ Ø§Ù†ÙˆØ§Ø¹ Ù…Ù‚Ø§Ø·Ø¹ ØªØ­ØµÛŒÙ„ÛŒ Ø¯Ø± Ø¢Ù„Ù…Ø§Ù†", "ğŸ—£ï¸ ØªØ­ØµÛŒÙ„ Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŸ",
        "ğŸ“„ Ù¾Ø°ÛŒØ±Ø´ Ù…Ø´Ø±ÙˆØ· ÛŒØ§ Ù…Ø³ØªÙ‚ÛŒÙ…ØŸ", "ğŸ“ Ø§Ù†ÙˆØ§Ø¹ Ø¢Ø²Ù…ÙˆÙ† Ù‡Ø§ÛŒ Ø²Ø¨Ø§Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ", "ğŸ“¬ Ú†Ø·ÙˆØ± Ù¾Ø°ÛŒØ±Ø´ Ø¨Ú¯ÛŒØ±ÛŒÙ…ØŸ",
        "ğŸ“ Ø¨ÙˆØ±Ø³ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ", "ğŸ’° Ù‡Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²Ù†Ø¯Ú¯ÛŒ Ø¯Ø± Ø¢Ù„Ù…Ø§Ù†", "ğŸ‘¨â€ğŸ’¼ Ú©Ø§Ø± Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ Ø¯Ø± Ø¢Ù„Ù…Ø§Ù†",
        "ğŸ“Š ØªØ¨Ø¯ÛŒÙ„ Ù…Ø¹Ø¯Ù„ Ø§ÛŒØ±Ø§Ù† Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†ÛŒ", "ğŸ’¼ Ø¨Ø§Ø²Ø§Ø± Ú©Ø§Ø± Ùˆ Ø¯Ø±Ø¢Ù…Ø¯ Ø±Ø´ØªÙ‡ Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¯Ø± Ø¢Ù„Ù…Ø§Ù†",
        "ğŸª– Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø´Ù…ÙˆÙ„Ø§Ù† Ø³Ø±Ø¨Ø§Ø²ÛŒ", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÙˆÛŒØ²Ø§ÛŒ Ù¾ÛŒÙˆØ³Øª Ø¨Ù‡ Ù‡Ù…Ø³Ø± Ùˆ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡"
    ],
    "2. ğŸ“„ Ù…Ø¯Ø§Ø±Ú© Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ù¾Ø°ÛŒØ±Ø´": [
        "ğŸ—£ï¸ Ø§Ø®Ø° Ù…Ø¯Ø±Ú© Ø²Ø¨Ø§Ù†", "ğŸ“ ØªØ±Ø¬Ù…Ù‡ Ù…Ø¯Ø§Ø±Ú©", "ğŸ’¡ Ø³Ø§Ø®Øª Ø§Ù†Ú¯ÛŒØ²Ù‡ Ù†Ø§Ù…Ù‡", "ğŸ“„ Ø³Ø§Ø®Øª Ø±ÙˆØ²Ù…Ù‡",
        "ğŸ¨ Ø³Ø§Ø®Øª Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ", "ğŸ“¨ ØªÙˆØµÛŒÙ‡ Ù†Ø§Ù…Ù‡ Ø§Ø² Ø§Ø³Ø§ØªÛŒØ¯", "ğŸ§¾ Ú¯ÙˆØ§Ù‡ÛŒ Ø³Ø§ÛŒÙ‚Ù‡ Ú©Ø§Ø±",
        "âœ… ØªØ§ÛŒÛŒØ¯ (Ù„Ú¯Ø§Ù„/Ø¨Ú¯Ù„Ø§) Ù…Ø¯Ø§Ø±Ú© ØªØ±Ø¬Ù…Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± Ø³ÙØ§Ø±Øª"
    ],
    "3. ğŸ“¬ Ù…Ø±Ø§Ø­Ù„ Ø§Ø®Ø° Ù¾Ø°ÛŒØ±Ø´": [
        "ğŸ« Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ ÛŒØ§ Ù‡ÙˆØ®Ø´ÙˆÙ„Ù‡ØŸ", "ğŸ“Š Ø±Ù†Ú©ÛŒÙ†Ú¯ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ù‡Ø§ÛŒ Ø¢Ù„Ù…Ø§Ù†", "ğŸ“… Ø¯Ø¯Ù„Ø§ÛŒÙ† Ù¾Ø°ÛŒØ±Ø´",
        "ğŸ” Ø³Ø§ÛŒØª Ù‡Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ùˆ Ø±Ø´ØªÙ‡", "ğŸŒ Ù¾Ø°ÛŒØ±Ø´ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø³Ø§ÛŒØª ÛŒÙˆÙ†ÛŒ Ø§Ø³ÛŒØ³Øª",
        "ğŸ“˜ Ø³Ø§ÛŒØª Ø¢Ù†Ø§Ø¨ÛŒÙ†", "ğŸ“¥ Ø§Ø®Ø° Ù¾Ø°ÛŒØ±Ø´ Ø§Ø² Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡", "ğŸ“¦ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¯Ø§Ø±Ú© Ø¨Ù‡ ØµÙˆØ±Øª Ù¾Ø³ØªÛŒ",
        "ğŸ“ Ø«Ø¨Øª Ù†Ø§Ù… Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡", "ğŸ›¡ï¸ Ø¨ÛŒÙ…Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ", "ğŸ  Ú¯Ø±ÙØªÙ† Ø®ÙˆØ§Ø¨Ú¯Ø§Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ"
    ],
    "4. ğŸ›‚ Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Øª": [
        "ğŸ“… Ú¯Ø±ÙØªÙ† Ù†ÙˆØ¨Øª Ø³ÙØ§Ø±Øª", "ğŸ“‹ Ú†Ú© Ù„ÛŒØ³Øª Ù…Ø¯Ø§Ø±Ú© Ø±ÙˆØ² Ù…ØµØ§Ø­Ø¨Ù‡", "â“ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„ Ø±ÙˆØ² Ù…ØµØ§Ø­Ø¨Ù‡",
        "ğŸ—£ï¸ Ù…ØµØ§Ø­Ø¨Ù‡ Ùˆ ØªØ­ÙˆÛŒÙ„ ÙˆÛŒØ²Ø§", "â›” Ø¯Ù„Ø§ÛŒÙ„ Ù…Ø¹Ù…ÙˆÙ„ Ø±ÛŒØ¬Ú©ØªÛŒ"
    ],
    "5. âœˆï¸ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†": [
        "ğŸ« Ø®Ø±ÛŒØ¯ Ø¨Ù„ÛŒØ· Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§", "ğŸ’ Ú†Ù‡ ÙˆØ³Ø§ÛŒÙ„ÛŒ Ø¨Ø§ Ø®ÙˆØ¯Ù… Ø¨Ø¨Ø±Ù…ØŸ", "ğŸ›¬ ÙØ±ÙˆØ¯Ú¯Ø§Ù‡ Ùˆ ÙØ±Ù… Ø²ÙˆÙ„",
        "ğŸ  Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø®ÙˆØ§Ø¨Ú¯Ø§Ù‡ Ùˆ Ø®Ø§Ù†Ù‡", "ğŸ“± Ø®Ø±ÛŒØ¯ Ø³ÛŒÙ… Ú©Ø§Ø±Øª Ø¯Ø± Ø¢Ù„Ù…Ø§Ù†", "ğŸ¢ Ø«Ø¨Øª Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª (Ù…Ù„Ø¯Ù‡ Ú©Ø±Ø¯Ù†)",
        "ğŸ¦ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ", "ğŸªª Ú¯Ø±ÙØªÙ† Ú©Ø§Ø±Øª Ø§Ù‚Ø§Ù…Øª", "ğŸ” ØªÙ…Ø¯ÛŒØ¯ Ø§Ù‚Ø§Ù…Øª Ø¨Ø¹Ø¯ Ø§Ø² ÛŒÚ©Ø³Ø§Ù„"
    ]
}

# âœ… /start command handler
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_name = update.effective_user.full_name

    with open("users_log.txt", "a", encoding="utf-8") as f:
        f.write(f"{user_id} - {user_name}\n")

    await update.message.reply_text(
        "Ø³Ù„Ø§Ù… ğŸ‘‹\nØ¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ù‡Ø§Ø¬Ø±Øª Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù† Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!",
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU, resize_keyboard=True)
    )

# âœ… Split list into rows of n
def split_into_rows(items, row_size=2):
    return [items[i:i+row_size] for i in range(0, len(items), row_size)]

# âœ… Menu handler
async def handle_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    choice = update.message.text

    # Main responses first (to avoid conflict with subitem headers)
    main_responses = {
        "â“ Ø³ÙˆØ§Ù„Ø§Øª Ù¾Ø±ØªÚ©Ø±Ø§Ø±": "â„¹ï¸ Ù¾Ø±Ø³Ø´â€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒØ¬ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ...",
        "ğŸ”— Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø®": "ğŸ’¬ Ù„ÛŒÙ†Ú© Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø®: ...",
        "ğŸ’¼ Ø®Ø¯Ù…Ø§Øª Ù…Ù‡Ø§Ø¬Ø±ØªÛŒ": "ğŸ§³ Ø®Ø¯Ù…Ø§Øª Ù…Ø§ Ø´Ø§Ù…Ù„ Ø§Ù¾Ù„Ø§ÛŒØŒ ÙˆÛŒØ²Ø§ØŒ ØªØ±Ø¬Ù…Ù‡ Ùˆ ...",
        "ğŸ“¬ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§": "ğŸ“¨ @your_support",
        "ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„": "ğŸ—‚ï¸ Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„ Ù…Ù‡Ø§Ø¬Ø±Øª: Ø§Ø² ØªØ­Ù‚ÛŒÙ‚ ØªØ§ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†..."
    }

    if choice in main_responses:
        await update.message.reply_text(main_responses[choice])
        return

    if choice == "ğŸ“ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù…Ù‡Ø§Ø¬Ø±Øª":
        await update.message.reply_text(
            "Ù„Ø·ÙØ§ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            reply_markup=ReplyKeyboardMarkup(CHECKLIST_MENU, resize_keyboard=True)
        )
        return

    if choice == "ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ":
        await update.message.reply_text(
            "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ",
            reply_markup=ReplyKeyboardMarkup(MAIN_MENU, resize_keyboard=True)
        )
        return

    if choice == "ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³Øª":
        await update.message.reply_text(
            "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù…Ù‡Ø§Ø¬Ø±Øª:",
            reply_markup=ReplyKeyboardMarkup(CHECKLIST_MENU, resize_keyboard=True)
        )
        return

    if choice in CHECKLIST_SUBITEMS:
        sub_items = CHECKLIST_SUBITEMS[choice]
        sub_menu = split_into_rows(sub_items, 2) + [["ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³Øª"]]
        await update.message.reply_text(
            f"Ù„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Â«{choice}Â» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            reply_markup=ReplyKeyboardMarkup(sub_menu, resize_keyboard=True)
        )
        return

    await update.message.reply_text("Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.")

# âœ… App startup
if __name__ == '__main__':
    app = ApplicationBuilder().token(os.getenv("BOT_TOKEN")).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_menu))
    app.run_polling()
